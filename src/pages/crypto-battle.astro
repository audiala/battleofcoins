---
import Layout from '../layouts/Layout.astro';
import CryptoBattleComponent from '../components/CryptoBattle';
import { readFileSync, readdirSync } from 'node:fs';
import { join } from 'node:path';
import { load } from 'js-yaml';
import '../styles/battle.css';
import type { CryptoData } from '../components/CryptoTable';

// Read the YAML file for default cryptos
const dataDir = join(process.cwd(), 'data');
const files = readdirSync(dataDir);
const latestFile = files
  .filter(f => f.startsWith('top_500_coins_'))
  .sort()
  .reverse()[0];

const yamlContent = readFileSync(join(dataDir, latestFile), 'utf8');
const cryptoData = load(yamlContent) as CryptoData[];

// Default to top 16 if no selection
const default_cryptos = cryptoData.slice(0, 16);

// Add console log for debugging
console.log('Default cryptos loaded:', default_cryptos.length);
---

<Layout title="Crypto Battle Tournament">
  <main>
    <div class="selection-container">
      <a href="/crypto-table" class="select-coins-button">
        Select Coins
        <span class="arrow">â†’</span>
      </a>
    </div>
    <div id="battle-container">
      <CryptoBattleComponent 
        client:load 
        cryptos={default_cryptos}
        data-component="CryptoBattle"
      />
    </div>
  </main>
</Layout>

<style>
  .selection-container {
    text-align: center;
    margin: 2rem 0;
  }

  .select-coins-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: #f53e98;
    color: white;
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .select-coins-button:hover {
    background: #f52e88;
    transform: translateY(-2px);
  }

  .arrow {
    transition: transform 0.2s ease;
  }

  .select-coins-button:hover .arrow {
    transform: translateX(4px);
  }
</style>

<script>
  // No need for hydration script anymore, component handles it internally
  console.log('Battle page loaded');
</script>