---
import Layout from '../layouts/Layout.astro';
import CryptoTableComponent from '../components/CryptoTable';
import '../styles/crypto-table.css';
import { readFileSync, readdirSync } from 'fs';
import { join } from 'path';
import { load } from 'js-yaml';
import '../styles/main.css';
import type { CryptoData } from '../components/CryptoTable';

// Read the YAML file
const dataDir = join(process.cwd(), 'data');
const files = readdirSync(dataDir);
const latestFile = files
  .filter(f => f.startsWith('top_500_coins_'))
  .sort()
  .reverse()[0];

const yamlContent = readFileSync(join(dataDir, latestFile), 'utf8');
const cryptoData = load(yamlContent) as CryptoData[];

console.log('Loaded crypto data:', cryptoData.length);
---

<Layout title="Crypto Table">
  <CryptoTableComponent client:load data={cryptoData.slice(0, 10)} />
</Layout> 